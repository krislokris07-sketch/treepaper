<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–æ–±–µ—Ä–∏ –∫–∞—Ä—Ç—É —Å–æ–∫—Ä–æ–≤–∏—â</title>
    <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;700&family=Marck+Script&family=Pirata+One&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-user-select: none;
            user-select: none;
        }

        body {
            font-family: 'Caveat', cursive;
            background: #1a2f1a url('—Ñ–æ–Ω_—Å—Ç—Ä–∞–Ω–∏—Ü—ã.jpg') no-repeat center center fixed;
            background-size: cover;
            color: #f5e6c8;
            min-height: 100vh;
            overflow-x: hidden;
            touch-action: manipulation;
            letter-spacing: 0.5px;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 15px;
        }

        .story-text {
            text-align: center;
            margin-bottom: 20px;
            background: rgba(20, 12, 4, 0.85);
            padding: 20px;
            border-radius: 15px;
            border: 3px solid #5d4037;
            backdrop-filter: blur(8px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6);
        }

        .story-text h1 {
            font-family: 'Pirata One', cursive;
            font-size: 3.5em;
            color: #d4af37;
            margin-bottom: 15px;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.8);
            letter-spacing: 2px;
            font-weight: normal;
        }

        .story-text p {
            font-family: 'Marck Script', cursive;
            font-size: 1.8em;
            line-height: 1.6;
            color: #e6d7b8;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.7);
        }

        .game-area {
            display: flex;
            flex-direction: column;
            gap: 25px;
            margin-bottom: 20px;
        }

        .map-frame {
            position: relative;
            background: #2d1b0f url('—Ñ–æ–Ω_–∫–∞—Ä—Ç—ã.jpg') no-repeat center center;
            background-size: cover;
            border: 15px solid #5d4037;
            height: 60vh;
            min-height: 400px;
            border-radius: 12px;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.7);
            overflow: hidden;
        }

        .map-area {
            position: absolute;
            top: 50%;
            left: 47%;
            transform: translate(-50%, -50%);
            width: 360px;
            height: 240px;
            background: rgba(210, 180, 140, 0.05);
        }

        .pieces-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            padding: 20px;
            background: rgba(93, 64, 55, 0.7);
            border-radius: 12px;
            border: 3px solid #8d6e63;
            backdrop-filter: blur(5px);
        }

        .puzzle-piece {
            width: 90px;
            height: 90px;
            margin: 0 auto;
            transition: all 0.3s ease;
            border: 3px solid rgba(212, 175, 55, 0.6);
            background-size: cover;
            background-position: center;
            border-radius: 8px;
            box-shadow: 0 6px 20px rgba(212, 175, 55, 0.4);
            cursor: pointer;
            position: relative;
        }

        .puzzle-piece:active {
            transform: scale(0.95);
        }

        .puzzle-piece.placed {
            position: absolute;
            pointer-events: none;
            border: 3px solid #2e7d32;
            box-shadow: 0 0 30px rgba(46, 125, 50, 0.8);
            animation: snapPulse 1s ease-in-out;
        }

        .puzzle-piece.used {
            opacity: 0.3;
            transform: scale(0.8);
            pointer-events: none;
        }

        @keyframes snapPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .completion-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            background: rgba(20, 12, 4, 0.95);
            padding: 30px;
            border-radius: 15px;
            border: 4px solid #d4af37;
            display: none;
            z-index: 50;
            width: 85%;
            backdrop-filter: blur(10px);
            cursor: pointer;
            font-family: 'Marck Script', cursive;
        }

        .completion-message.show {
            display: block;
            animation: fadeIn 1s ease-in-out;
        }

        .completion-message h2 {
            font-family: 'Pirata One', cursive;
            color: #d4af37;
            margin-bottom: 20px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
        }

        .completion-message p {
            font-size: 1.8em;
            color: #e6d7b8;
            line-height: 1.5;
            margin-bottom: 10px;
        }

        .close-hint {
            margin-top: 20px;
            font-size: 1.3em;
            color: #d4af37;
            opacity: 0.9;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translate(-50%, -40%); }
            to { opacity: 1; transform: translate(-50%, -50%); }
        }

        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(93, 64, 55, 0.7);
            padding: 15px 25px;
            border-radius: 12px;
            border: 3px solid #8d6e63;
            backdrop-filter: blur(5px);
        }

        .progress {
            font-family: 'Marck Script', cursive;
            font-size: 1.5em;
            color: #d4af37;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.7);
        }

        .hint-button {
            background: linear-gradient(135deg, #5d4037, #8d6e63);
            color: #ffecb3;
            border: 3px solid #d4af37;
            border-radius: 25px;
            padding: 12px 25px;
            font-family: 'Caveat', cursive;
            font-size: 1.4em;
            cursor: pointer;
            transition: all 0.3s ease;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }

        .hint-button:active {
            background: linear-gradient(135deg, #8d6e63, #a1887f);
            transform: scale(0.95);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="story-text">
            <h1>–†–∞–∑–æ—Ä–≤–∞–Ω–Ω–∞—è –∫–∞—Ä—Ç–∞</h1>
            <p>–°—Ç–∞—Ä—ã–π –¥—É–± —Å–æ—Ö—Ä–∞–Ω–∏–ª –ø–æ–¥—Å–∫–∞–∑–∫—É, –Ω–æ –≤–µ—Ç—Ä–∞ —Ä–∞–∑–æ—Ä–≤–∞–ª–∏ –µ—ë –Ω–∞ —á–∞—Å—Ç–∏. –°–æ–±–µ—Ä–∏ –≤—Å–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã –∫–∞—Ä—Ç—ã, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å, –≥–¥–µ —Å–ø—Ä—è—Ç–∞–Ω –∫–ª—é—á –∫ —Å–ª–µ–¥—É—é—â–µ–π –≥–ª–∞–≤–µ...</p>
        </div>

        <div class="game-area">
            <div class="map-frame" id="mapFrame">
                <div class="map-area" id="mapArea"></div>
                <div class="completion-message" id="completionMessage">
                    <h2>üéâ –ö–∞—Ä—Ç–∞ —Å–æ–±—Ä–∞–Ω–∞!</h2>
                    <p>–ü–æ—Å–º–æ—Ç—Ä–∏ –Ω–∞ —Å–æ–±—Ä–∞–Ω–Ω—É—é –∫–∞—Ä—Ç—É - —Ç–∞–º —É–∫–∞–∑–∞–Ω–æ –º–µ—Å—Ç–æ–Ω–∞—Ö–æ–∂–¥–µ–Ω–∏–µ –ø–æ–¥–∞—Ä–∫–∞!</p>
                    <p class="close-hint">—Ç—ã–∫!!</p>
                </div>
            </div>
            
            <div class="pieces-container" id="piecesContainer">
                <!-- –§—Ä–∞–≥–º–µ–Ω—Ç—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
            </div>
        </div>

        <div class="controls">
            <div class="progress">
                –°–æ–±—Ä–∞–Ω–æ: <span id="progressCount">0</span>/6 —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤
            </div>
            <button id="hintButton" class="hint-button">üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞</button>
        </div>
    </div>

    <script>
        class PuzzleGame {
            constructor() {
                this.pieces = [];
                this.snappedPieces = 0;
                this.totalPieces = 6;
                this.isCompleted = false;
                
                this.elements = {
                    piecesContainer: document.getElementById('piecesContainer'),
                    mapFrame: document.getElementById('mapFrame'),
                    mapArea: document.getElementById('mapArea'),
                    progressCount: document.getElementById('progressCount'),
                    completionMessage: document.getElementById('completionMessage'),
                    hintButton: document.getElementById('hintButton')
                };
                
                this.init();
            }
            
            init() {
                this.loadBackgrounds();
                this.createPieces();
                this.setupEventListeners();
            }
            
            shuffleArray(array) {
                const newArray = [...array];
                for (let i = newArray.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
                }
                return newArray;
            }
            
            loadBackgrounds() {
                const bodyBg = new Image();
                bodyBg.onload = () => {
                    document.body.style.backgroundImage = "url('—Ñ–æ–Ω_—Å—Ç—Ä–∞–Ω–∏—Ü—ã.jpg')";
                };
                bodyBg.src = '—Ñ–æ–Ω_—Å—Ç—Ä–∞–Ω–∏—Ü—ã.jpg';
                
                const mapBg = new Image();
                mapBg.onload = () => {
                    this.elements.mapFrame.style.backgroundImage = "url('—Ñ–æ–Ω_–∫–∞—Ä—Ç—ã.jpg')";
                };
                mapBg.src = '—Ñ–æ–Ω_–∫–∞—Ä—Ç—ã.jpg';
            }
            
            createPieces() {
                // –°–æ–∑–¥–∞–µ–º –º–∞—Å—Å–∏–≤ —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å–≤—è–∑—å—é —Ñ–∞–π–ª-–ø–æ–∑–∏—Ü–∏—è
                const pieceData = [
                    { fileName: '–≤–µ—Ä—Ö–Ω–∏–π_–ª–µ–≤—ã–π.png', position: { x: 0, y: 0 } },
                    { fileName: '–≤–µ—Ä—Ö–Ω–∏–π_—Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π.png', position: { x: 120, y: 0 } },
                    { fileName: '–≤–µ—Ä—Ö–Ω–∏–π_–ø—Ä–∞–≤—ã–π.png', position: { x: 240, y: 0 } },
                    { fileName: '–Ω–∏–∂–Ω–∏–π_–ª–µ–≤—ã–π.png', position: { x: 0, y: 120 } },
                    { fileName: '–Ω–∏–∂–Ω–∏–π_—Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π.png', position: { x: 120, y: 120 } },
                    { fileName: '–Ω–∏–∂–Ω–∏–π_–ø—Ä–∞–≤—ã–π.png', position: { x: 240, y: 120 } }
                ];
                
                // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–æ—Ä—è–¥–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è, –Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å–≤—è–∑—å —Ñ–∞–π–ª-–ø–æ–∑–∏—Ü–∏—è
                const shuffledPieces = this.shuffleArray([...pieceData]);
                
                for (let i = 0; i < this.totalPieces; i++) {
                    const piece = document.createElement('div');
                    piece.className = 'puzzle-piece';
                    piece.dataset.pieceId = i;
                    piece.style.backgroundImage = "url('" + shuffledPieces[i].fileName + "')";
                    
                    this.pieces.push({
                        element: piece,
                        id: i,
                        isPlaced: false,
                        position: shuffledPieces[i].position, // –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è –¥–ª—è —ç—Ç–æ–≥–æ —Ñ–∞–π–ª–∞
                        fileName: shuffledPieces[i].fileName
                    });
                    
                    this.elements.piecesContainer.appendChild(piece);
                }
            }
            
            setupEventListeners() {
                this.pieces.forEach(pieceData => {
                    pieceData.element.addEventListener('click', () => {
                        if (pieceData.isPlaced || this.isCompleted) return;
                        this.placePiece(pieceData);
                    });
                });
                
                this.elements.hintButton.addEventListener('click', () => this.showHint());
                this.setupMessageClose();
            }
            
            setupMessageClose() {
                this.elements.completionMessage.addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.hideCompletionMessage();
                });
                
                document.addEventListener('click', () => {
                    this.hideCompletionMessage();
                });
                
                this.elements.mapFrame.addEventListener('click', (e) => {
                    e.stopPropagation();
                });
                
                this.elements.piecesContainer.addEventListener('click', (e) => {
                    e.stopPropagation();
                });
            }
            
            hideCompletionMessage() {
                if (this.elements.completionMessage.classList.contains('show')) {
                    this.elements.completionMessage.classList.remove('show');
                }
            }
            
            placePiece(pieceData) {
                pieceData.isPlaced = true;
                const piece = pieceData.element;
                
                piece.classList.add('used');
                
                const placedPiece = piece.cloneNode(true);
                placedPiece.classList.remove('used');
                placedPiece.classList.add('placed');
                
                const mapAreaRect = this.elements.mapArea.getBoundingClientRect();
                const frameRect = this.elements.mapFrame.getBoundingClientRect();
                
                placedPiece.style.left = (mapAreaRect.left - frameRect.left + pieceData.position.x) + 'px';
                placedPiece.style.top = (mapAreaRect.top - frameRect.top + pieceData.position.y) + 'px';
                
                this.elements.mapFrame.appendChild(placedPiece);
                
                this.snappedPieces++;
                this.updateProgress();
                
                if (this.snappedPieces === this.totalPieces) {
                    this.completePuzzle();
                }
            }
            
            updateProgress() {
                this.elements.progressCount.textContent = this.snappedPieces;
            }
            
            completePuzzle() {
                this.isCompleted = true;
                this.elements.completionMessage.classList.add('show');
            }
            
            showHint() {
                if (this.isCompleted) return;
                
                const unusedPiece = this.pieces.find(piece => !piece.isPlaced);
                if (unusedPiece) {
                    const piece = unusedPiece.element;
                    const originalTransform = piece.style.transform;
                    const originalBoxShadow = piece.style.boxShadow;
                    
                    piece.style.transform = 'scale(1.2)';
                    piece.style.boxShadow = '0 0 30px gold';
                    
                    setTimeout(() => {
                        piece.style.transform = originalTransform;
                        piece.style.boxShadow = originalBoxShadow;
                    }, 1500);
                }
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            new PuzzleGame();
        });
    </script>
</body>
</html>
